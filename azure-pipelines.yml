# https://aka.ms/yaml

jobs:
- job: python_lint
  displayName: 'Lint Job'
  pool:
    vmImage: ubuntu-16.04

  steps:
  - task: UsePythonVersion@0
    displayName: 'Set Python Version'
    inputs:
      versionSpec: '3.7.x'
      addToPath: true

  - script: python3 -m pip install pipenv && pipenv install --dev --system && python3 -m pip install flake8-formatter-junit-xml
    displayName: 'Install Project Environment'

  - script: python3 -m flake8 --format junit-xml --output-file test-lint.xml
    displayName: 'Run Linter'

  - task: PublishTestResults@2
    condition: succeededOrFailed()
    inputs:
      testResultsFiles: '**/test-*.xml'
      testRunTitle: 'Site-Django Lint Results'

  - task: DockerCompose@0
    displayName: Run PostgreSQL DB
    inputs:
      action: Run a specific service
      dockerComposeFile: docker-compose.yml
      projectName: pydis_web
      ports: 7777
      detached: true
      serviceName: postgres
